% A LaTeX template for MSc Thesis submissions to 
% Politecnico di Milano (PoliMi) - School of Industrial and Information Engineering
%
% S. Bonetti, A. Gruttadauria, G. Mescolini, A. Zingaro
% e-mail: template-tesi-ingind@polimi.it
%
% Last Revision: October 2021
%
% Copyright 2021 Politecnico di Milano, Italy. NC-BY

\documentclass{Configuration_Files/PoliMi3i_thesis}

%------------------------------------------------------------------------------
%	REQUIRED PACKAGES AND  CONFIGURATIONS
%------------------------------------------------------------------------------

% CONFIGURATIONS
\usepackage{parskip} % For paragraph layout
\usepackage{setspace} % For using single or double spacing
\usepackage{emptypage} % To insert empty pages
\usepackage{multicol} % To write in multiple columns (executive summary)
\setlength\columnsep{15pt} % Column separation in executive summary
\setlength\parindent{0pt} % Indentation
\raggedbottom  

% PACKAGES FOR TITLES
\usepackage{titlesec}
% \titlespacing{\section}{left spacing}{before spacing}{after spacing}
\titlespacing{\section}{0pt}{3.3ex}{2ex}
\titlespacing{\subsection}{0pt}{3.3ex}{1.65ex}
\titlespacing{\subsubsection}{0pt}{3.3ex}{1ex}
\usepackage{color}

% PACKAGES FOR LANGUAGE AND FONT
\usepackage[english]{babel} % The document is in English  
\usepackage[utf8]{inputenc} % UTF8 encoding
\usepackage[T1]{fontenc} % Font encoding
\usepackage[11pt]{moresize} % Big fonts

% PACKAGES FOR IMAGES
\usepackage{graphicx}
\usepackage{transparent} % Enables transparent images
\usepackage{eso-pic} % For the background picture on the title page
\usepackage{subcaption} % Numbered and caption subfigures using \subfloat.
\usepackage{tikz} % A package for high-quality hand-made figures.
\usetikzlibrary{}
\graphicspath{{./Images/}} % Directory of the images
\usepackage{caption} % Coloured captions
\usepackage{xcolor} % Coloured captions
\usepackage{amsthm,thmtools,xcolor} % Coloured "Theorem"
\usepackage{float}

% STANDARD MATH PACKAGES
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{bm}
\usepackage[overload]{empheq} % For braced-style systems of equations.
\usepackage{fix-cm} % To override original LaTeX restrictions on sizes

% PACKAGES FOR TABLES
\usepackage{tabularx}
\usepackage{longtable} % Tables that can span several pages
\usepackage{colortbl}

% PACKAGES FOR ALGORITHMS (PSEUDO-CODE)
\usepackage{algorithm}
\usepackage{algorithmic}

% PACKAGES FOR REFERENCES & BIBLIOGRAPHY
\usepackage[colorlinks=true,linkcolor=black,anchorcolor=black,citecolor=black,filecolor=black,menucolor=black,runcolor=black,urlcolor=black]{hyperref} % Adds clickable links at references
\usepackage{cleveref}
\usepackage[square, numbers, sort&compress]{natbib} % Square brackets, citing references with numbers, citations sorted by appearance in the text and compressed
\bibliographystyle{abbrvnat} % You may use a different style adapted to your field

% OTHER PACKAGES
\usepackage{pdfpages} % To include a pdf file
\usepackage{afterpage}
\usepackage{lipsum} % DUMMY PACKAGE
\usepackage{fancyhdr} % For the headers
\fancyhf{}

% Input of configuration file. Do not change config.tex file unless you really know what you are doing. 
\input{Configuration_Files/config}

%----------------------------------------------------------------------------
%	NEW COMMANDS DEFINED
%----------------------------------------------------------------------------


%----------------------------------------------------------------------------
%	ADD YOUR PACKAGES (be careful of package interaction)
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
%	ADD YOUR DEFINITIONS AND COMMANDS (be careful of existing commands)
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
%	BEGIN OF YOUR DOCUMENT
%----------------------------------------------------------------------------

\begin{document}

\fancypagestyle{plain}{%
\fancyhf{} % Clear all header and footer fields
\fancyhead[RO,RE]{\thepage} %RO=right odd, RE=right even
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}}

%----------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------

\pagestyle{empty} % No page numbers
\frontmatter % Use roman page numbering style (i, ii, iii, iv...) for the preamble pages

\puttitle{
	title=Evolutionary-based procedural\\content generation for First\\Person Shooters in Unity, % Title of the thesis
	name=Simone Bari, % Author Name and Surname
	course=Computer Science and Engineering - Ingegneria \mbox{Informatica}, % Study Programme (in Italian)
	ID  = 944517,  % Student ID number (numero di matricola)
	advisor= Prof. Daniele Loiacono, % Supervisor name
	coadvisor=Prof. Pier Luca Lanzi, % Co-Supervisor name, remove this line if there is none
	academicyear={2021-22},  % Academic Year
} % These info will be put into your Title page 

%----------------------------------------------------------------------------
%	PREAMBLE PAGES: ABSTRACT (inglese e italiano), EXECUTIVE SUMMARY
%----------------------------------------------------------------------------
\startpreamble
\setcounter{page}{1} % Set page counter to 1

% ABSTRACT IN ENGLISH
\chapter*{Abstract} 
\textit{Level design} plays a fundamental role in the development of a video game and is one of the components that most influences its final quality. However, there is currently a lack of discipline for this task, and often \textit{level design} is seen more as an art to be entrusted to experience and common sense, without a more accurate scientific investigation.

In recent years, the academic world has begun to take its first timid steps towards studying this field, but there is still a lack of common vocabularies and standard techniques and tools to evaluate and test theories, especially in the context of first-person shooters.

An attempt to introduce an open-source tool that would address this problem was made by Ballabio, who introduced a modern open-source framework in \textit{Unity} that represents a skeleton of an FPS. However, this framework has a serious flaw in the lack of bots that allow the simulation of various matches and the subsequent extraction of observed gameplay dynamics.

In our work, we wanted to overcome this limitation by designing and developing a relatively simple and flexible bot system, in order to be able exploit the capabilities of procedural content generation with search algorithms, already tested in various other studies, using the framework.

After having introduced bots, we wanted to test a novel approach to map representation based on graphs, comparing the results obtained from various genetic evolutions using this representation with another more well-known and widespread representation.

% Here goes the Abstract in English of your thesis followed by a list of keywords.
% The Abstract is a concise summary of the content of the thesis (single page of text) and a guide to the most important contributions included in your thesis.
% The Abstract is the very last thing you write.
% It should be a self-contained text and should be clear to someone who hasn't (yet) read the whole manuscript.
% The Abstract should contain the answers to the main scientific questions that have been addressed in your thesis.
% It needs to summarize the adopted motivations and the adopted methodological approach as well as the findings of your work and their relevance and impact.
% The Abstract is the part appearing in the record of your thesis inside POLITesi, the Digital Archive of PhD and Master Theses (Laurea Magistrale) of Politecnico di Milano.
% The Abstract will be followed by a list of four to six keywords.
% Keywords are a tool to help indexers and search engines to find relevant documents. To be relevant and effective, keywords must be chosen carefully. They should represent the content of your work and be specific to your field or sub-field. Keywords may be a single word or two to four words. 

\textbf{Keywords:} \textit{Level design}, videogame bots, procedural content generation, graph theory. % Keywords

% ABSTRACT IN ITALIAN
\chapter*{Abstract in lingua italiana}
Il \textit{level design} è un aspetto fondamentale nello sviluppo di un videogioco e rappresenta una delle componenti che maggiormente influenzano la qualità finale del prodotto. Tuttavia, attualmente non esiste una disciplina consolidata per tale attività e spesso il level design viene considerato come un'arte da affidare all'esperienza e al buon senso, senza che venga applicato un approccio scientifico più rigoroso.

Negli ultimi anni, il mondo accademico ha iniziato a esplorare questa area di ricerca, ma ancora mancano vocabolari comuni, tecniche e strumenti standard per valutare le teorie e testarle, soprattutto nel contesto degli sparatutto in prima persona.

Un tentativo di ovviare a questa mancanza è stato fatto da Ballabio, che ha introdotto un moderno framework open-source in \textit{Unity} che rappresenta uno scheletro di un FPS. Tuttavia, il framework presenta una grave carenza nella mancanza di bot per la simulazione di partite e l'estrazione delle dinamiche di gioco osservate.

Nel nostro lavoro, abbiamo voluto colmare questa lacuna progettando e sviluppando un sistema di bot relativamente semplice e flessibile, in modo da poter sfruttare le capacità della generazione procedurale di contenuti con algoritmi di ricerca, già testati in altre ricerche, direttamente usando il Framework.

Una volta introdotto i bot, abbiamo infine voluto testare un innovativo approccio alla rappresentazione di mappe basato sui grafi, confrontando i risultati ottenuti dalle evoluzioni genetiche che utilizzano tale rappresentazione con quelli di una rappresentazione più diffusa e conosciuta.

\textbf{Parole chiave:} \textit{Level design}, bot per videogiochi, generazione procedurale di contenuti, teoria dei grafi.   % Keywords (italian)

%----------------------------------------------------------------------------
%	LIST OF CONTENTS/FIGURES/TABLES/SYMBOLS
%----------------------------------------------------------------------------

% TABLE OF CONTENTS
\thispagestyle{empty}
\tableofcontents % Table of contents 
\thispagestyle{empty}
\cleardoublepage

% LIST OF FIGURES
\listoffigures

% LIST OF TABLES
%\listoftables

% LIST OF SYMBOLS
% Write out the List of Symbols in this page


%-------------------------------------------------------------------------
%	THESIS MAIN TEXT
%-------------------------------------------------------------------------

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\mainmatter % Begin numeric (1,2,3...) page numbering

% --------------------------------------------------------------------------
% NUMBERED CHAPTERS % Regular chapters following
% --------------------------------------------------------------------------

\input{Chapters/chapter_introduction}

\input{Chapters/chapter_state_of_the_art}

\input{Chapters/chapter_video_game_bots}

\input{Chapters/chapter_unity_framework}

\input{Chapters/chapter_experiments}

\chapter{Conclusions and future developments}
\label{ch:conclusions}%
The purpose of this thesis was to extend the \textit{Unity} framework created by Ballabio \cite{ballabio_framework} in order to add support for bots with diverse profiles and characteristics and to use this framework to test a novel graph-based approach to map encoding. 

Previous works in the field of \textit{Procedural Content Generation} for \textit{First-Person Shooters} have either used open-source game such as \textit{Cube 2: Sauerbraten}, which are usually rather outdated and difficult to modify, or have written a new engine from scratch, which is a huge effort that probably does not repay the single research. 
The open-source framework of Ballabio, developed on the modern game engine \textit{Unity}, combined with the ability to simulate matches with the bots developed in this research, provides an excellent starting tool for any possible future research, whether it collects data from real players, offline or online, or from simulated matches with bots, or combines the two approaches.

We wanted to design and implement bots that were easy to understand and modify, but still showed interesting behaviors and were able to react to the continuous evolution of the game situation. Therefore, we aimed for a modular and easily extensible approach, creating a bot whose layered structure allows for the easy addition or replacement of components. In addition, the bot goal system used to determine what to pursue at any given moment is easily integrable. Indeed, it is possible to add new goals simply by defining their score based on the bot conditions and using the expressive power and elegance of the behavior tree to define how the goal is pursued. Finally, the bot characterization system allows for the calibration of the bot abilities (such as aiming, reflexes, and movement) and tendencies (reckless or more cautious) to better emulate different profiles of human players.

Thanks to these bots and Ballabio's framework we were able to test a new map encoding, \textit{Grid-graph}, and the experiments performed demonstrated that, applied to evolutionary algorithms with search space exploration, this representation is able to generate maps that are at least as valid as those of the \textit{All-black} representation, first introduced by Cardamone \cite{cardamone_evolving_maps} and used ever since, while also generating maps with much clearer and more linear structures that should help better understand the influence that certain structures and topologies have on the gameplay dynamics that develop on the maps themselves.

\section{Known issues and possible criticism}
Our work represents a first step towards the introduction of a flexible open-source tool for map testing, but still presents some critical issues to be resolved before it can be freely used.

The main issue concerns the behavior of bots: in fact, it has not been thoroughly tested how realistic their behavior is, but we have focused only on verifying the balance of bot profiles based on the context in which they are placed. Furthermore, with only a limited number of currently defined objectives, bot behavior may be considered too simple by some. However, we have chosen this simplicity because for more complex artificial intelligence models for shooters it is often difficult to grasp what guides the choices that a bot makes and it's usually not possible to fine-tune their behaviour to faithfully replicate different players' gameplay style (see, for example, \cite{neural_network_bot_2} for a bot for Deathmatch in \textit{Half-life 2}\footnote{2004, Valve}, which uses a neural network to guide bot behavior and is not configurable in any way).

Additionally, since we based our work on Ballabio's thesis, which had not yet tested procedural content generation models, we do not currently have sufficient data to verify whether the results obtained in map evolution are consistent with those obtained from other research. Quite the opposite, comparing the "All-black" maps obtained in our experiment with those obtained by Arnaboldi \cite{arnaboldi_framework} in its first experiment, a significant difference can be noted in both the appearance of the maps and the behaviors observed by the collected metrics. We cannot pin-point the exact cause for this discrepancy, given the change in both engine and AI model used for the simulations, but this highlights the importance of having a reference framework for proper comparison of different research.

Finally, our comparison between the \textit{All-black} and \textit{Grid-graph} representations shows a slight advantage for the latter, but this advantage may not be significant and may depend on the type of experiment performed or might be caused by simple chance, given the limited number of simulations carried out.

However, from our analysis, it still emerges that the \textit{Grid-graph} representation is suitable for conducting procedural content generation experiments through search algorithms, as we noticed an increase in the entropy of the obtained maps, which corresponds to a significant variation of the kill ratio in favor of a greater balance of matches, especially if one considers the logarithmic nature of the metric. Considering the greater simplicity of the obtained maps and the better use of the key concepts of \textit{Rooms} and \textit{Corridors} of this representation, \textit{Grid-graph} has the potential to become an encoding of particular effectiveness in helping level designers in the development and testing of new maps and in understanding the dynamics that they allow to emerge during gameplay.

%-------------------------------------------------------------------------
%	BIBLIOGRAPHY
%-------------------------------------------------------------------------

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\bibliography{Thesis_bibliography} % The references information are stored in the file named "Thesis_bibliography.bib"

%-------------------------------------------------------------------------
%	APPENDICES
%-------------------------------------------------------------------------

\cleardoublepage
\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\appendix

\input{Chapters/appendix_a}

%\chapter*{List of Symbols} % You have to include a chapter for your list of symbols (
%\begin{table}[H]
%    \centering
%    \begin{tabular}{lll}
%        \textbf{Variable} & \textbf{Description} & \textbf{SI unit} \\\hline\\[-9px]
%        $\bm{u}$ & solid displacement & m \\[2px]
%        $\bm{u}_f$ & fluid displacement & m \\[2px]
%    \end{tabular}
%\end{table}

\cleardoublepage

\end{document}
